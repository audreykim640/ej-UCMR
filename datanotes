notes on joining data

I began by filtering the public water system boundary data based on what was available in the UCMR data to pare down the spatial data to only what will be relevant for the analysis. Then, I joined it with the spatial demographics data from the American Community Survey. This join was via spatial joins, which are computationally expensive and slow. (Joining PWS and UCMR data would create a larger dataset, which would be even slower, so I started here.) 
Using the sf package, I found which block groups overlapped each PWS. Then for each PWS, I attributed a proportion (or weight) to each block group, representing how much of the PWS boundary it intersected with. For instance, if part of block group 1 covered a quarter of the PWS in question, block group 1 received a 0.25. Then, other block groups overlapping with the PWS are assigned corresponding weights for that PWS. It is feasible that block groups appear multiple times in the dataset, receiving weights for different PWSs that they overlap with. 
After finding the weights, the weight for block group 1’s overlap with the PWS in questions is multiplied by the race, ethnicity, and total respondent counts. This statistic by weight multiplication occurs for each PWS-block group intersection, with PWSs possibly having multiple entries if it overlaps with multiple block groups. Then, for each PWS, all of the weighted statistics for that PWS are added together to create a cumulative weighted average for each of the statistics. 
	The result of this join is a dataframe with each PWS appearing once with spatial data and weighted average counts of Asian, Black, Indigenous, and white respondents as well as a weighted average total of respondents to the race question. Similarly, the data contains a weighted average count of Hispanic/Latin(o/a) respondents and a weighted average total count of respondents to the Hispanic/Latin(o/a) question. These weighted averages are often rough estimates, as they make the assumption that the distribution of counts is even and consistent throughout an area whereas in reality, it’s possible that people are not evenly distributed within an area. For instance, it’s possible that there exist no people in one particular overlapping part of a block group and PWS but the counts from that block group will still be weighted and attributed to that PWS.
	With this joined dataset, I performed some further data wrangling for later data analysis, including converting race/ethnicity counts to proportions to create more values that are more comparable across PWSs and creating a categorical variable that lists the race that makes up the greatest proportion of the population that a PWS serves (according to this data). I additionally siphoned ethnicity into a categorical variable indicating if a public water system is “Above” or “Below” the 50th percentile for proportion of Hispanic or Latino/a constituents.
	Then I joined this PWS-demographics dataset to the UCMR data using the dplyr package (like most of this data wrangling work). 
